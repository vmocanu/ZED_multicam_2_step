# ZED Spatial Mapping Fusion - Debug Configuration Guide

This document explains how to use the debugging configuration set up for the ZED Spatial Mapping Fusion project.

## Quick Start

### Option 1: Using the Debug Script (Recommended)
```bash
# Build and debug with default configuration
./debug.sh

# Clean build and debug
./debug.sh --clean

# Debug with custom configuration file
./debug.sh --config /path/to/your/config.json

# Build only (no debugging)
./debug.sh --build-only

# Run with Valgrind for memory debugging
./debug.sh --valgrind
```

### Option 2: Manual GDB Debugging
```bash
# Build in debug mode
mkdir -p build
cmake -DCMAKE_BUILD_TYPE=Debug -S . -B build
make -C build -j$(nproc)

# Run with GDB
cd build
gdb ./ZED_SpatialMappingFusion
(gdb) set args 2.json
(gdb) run
```

### Option 3: VSCode Debugging
1. Open the project in VSCode
2. Install the C/C++ extension
3. Press `F5` or go to Run > Start Debugging
4. Select "Debug ZED Spatial Mapping Fusion"

## Debug Features

### CMake Configuration
- **Debug Build Type**: Automatically set when `CMAKE_BUILD_TYPE=Debug`
- **Debug Symbols**: `-g` flag enabled for full symbol information
- **No Optimization**: `-O0` ensures no compiler optimizations interfere with debugging
- **Additional Warnings**: `-Wall -Wextra` for better code quality
- **Debug Macro**: `DDEBUG` defined for conditional debug code

### GDB Configuration (.gdbinit)
The project includes a custom `.gdbinit` file with:

#### Enhanced Display
- Pretty printing enabled for STL containers
- Object and vtable information display
- Colored output (if supported)
- 20 lines of context when showing source

#### ZED-Specific Commands
- `setup_common_breakpoints`: Set breakpoints at key functions
- `print_zed_error <code>`: Decode ZED SDK error codes
- `print_fusion_error <code>`: Decode Fusion API error codes
- `print_init_params`: Display current camera initialization parameters

#### Usage Examples
```gdb
(gdb) setup_common_breakpoints
(gdb) run
# When an error occurs:
(gdb) print_zed_error $eax
(gdb) print_fusion_error $ebx
```

### VSCode Configuration
Two debug configurations are available:

1. **Debug ZED Spatial Mapping Fusion**: Uses default `build/2.json` config
2. **Debug ZED Spatial Mapping Fusion (Custom Config)**: Prompts for config file

Both configurations:
- Build the project automatically before debugging
- Set working directory to `build/`
- Enable pretty printing
- Use Intel disassembly syntax

## Common Debugging Scenarios

### 1. Camera Initialization Issues
```gdb
(gdb) break ClientPublisher::open
(gdb) run
(gdb) print_init_params
(gdb) step
```

### 2. Fusion Process Debugging
```gdb
(gdb) break sl::Fusion::init
(gdb) break sl::Fusion::process
(gdb) run
```

### 3. Error Code Investigation
```gdb
# When a ZED function returns an error
(gdb) print state
(gdb) print_zed_error state
```

### 4. Memory Issues
```bash
# Use Valgrind for memory debugging
./debug.sh --valgrind
```

## Build Types

### Debug Build (Default)
- Compiler flags: `-g -O0 -DDEBUG -Wall -Wextra`
- No optimizations
- Full debug symbols
- Debug assertions enabled

### Release Build
```bash
cmake -DCMAKE_BUILD_TYPE=Release -S . -B build
make -C build -j$(nproc)
```

## Troubleshooting

### GDB Not Finding Symbols
```bash
# Ensure debug build
file build/ZED_SpatialMappingFusion
# Should show "not stripped"

# Check debug info
objdump -h build/ZED_SpatialMappingFusion | grep debug
```

### VSCode Debugging Not Working
1. Check that the C/C++ extension is installed
2. Verify the build task completes successfully
3. Ensure the executable path in `launch.json` is correct
4. Check that GDB is installed: `which gdb`

### Configuration File Issues
- Ensure the JSON configuration file exists
- Verify it was generated by ZED360 tool
- Check file permissions and path

## Advanced Debugging

### Core Dump Analysis
```bash
# Enable core dumps
ulimit -c unlimited

# After crash
gdb build/ZED_SpatialMappingFusion core
```

### Remote Debugging
```bash
# On target machine
gdbserver :2345 ./ZED_SpatialMappingFusion 2.json

# On development machine
gdb ./ZED_SpatialMappingFusion
(gdb) target remote target-ip:2345
```

### Performance Profiling
```bash
# With perf
perf record ./ZED_SpatialMappingFusion 2.json
perf report

# With gprof (requires -pg flag)
gprof ./ZED_SpatialMappingFusion gmon.out
```

## Tips

1. **Use watchpoints**: `watch variable_name` to break when a variable changes
2. **Conditional breakpoints**: `break main.cpp:100 if camera_id == 2`
3. **Thread debugging**: `info threads`, `thread 2`, `thread apply all bt`
4. **Reverse debugging**: Compile with `-ggdb3` and use `record` command
5. **Save sessions**: Use `.gdbinit` in your home directory for persistent settings




